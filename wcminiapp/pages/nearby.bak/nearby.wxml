<view class="page">
  <view class="header">
    <view class="title">Nearby</view>

    <view class="controls">
      <picker mode="selector" range="{{radiusOptions}}" bindchange="onRadiusChange">
        <view class="pill">Radius: {{radius}} km</view>
      </picker>

      <view class="refreshWrap" bindtap="onRefresh">
        <view class="refreshBtn">â†»</view>
      </view>

    </view>
  </view>

  <view wx:if="{{loading}}" class="state">Loading...</view>
  <view wx:if="{{error}}" class="state error">{{error}}</view>

  <view wx:if="{{!loading && !error}}">
    <view wx:if="{{stations.length === 0}}" class="state">No stations</view>

    <view
      wx:for="{{stations}}"
      wx:key="id"
      class="card"
      data-id="{{item.id}}"
      bindtap="onOpenStation"
    >
      <view class="cardTop">
        <view class="name">{{item.name}}</view>
        <view class="badge {{item.confidence}}">{{item.confidence}}</view>
      </view>

      <view class="metrics">
        <view class="metric">
          <view class="k">Price</view>
          <view class="v price">{{item.currentPriceText}}</view>
        </view>

        <view class="metric">
          <view class="k">Reports</view>
          <view class="v">{{item.reportCount}}</view>
        </view>

        <view class="metric">
          <view class="k">Updated</view>
          <view class="v">{{item.lastUpdatedText}}</view>
        </view>
      </view>
    </view>
  </view>
</view>